## 设置 Decoda 集成开发环境
本文将介绍如何设置 Decoda（用于编写 Lua 代码的集成开发环境），以便您可以使用集成开发环境开发 Cuberite 插件。
##关于 Decoda
简单介绍一下 Decoda，它是一个用于编写 Lua 代码的集成开发环境。它具备集成开发环境的基本功能--您可以将文件分组到项目中，可以在标签式编辑器中编辑多个文件，代码具有语法高亮显示。代码自动补全、符号浏览等。它还有一个 Lua 调试器，允许你在任何嵌入 Lua 运行时或将 Lua 用作动态链接库 (DLL) 的应用程序中调试你的 Lua 代码。虽然它是使用多平台 WxWidgets 工具包编写的，但尚未移植到 32 位 Windows 以外的任何平台。这意味着 Linux 用户将无法使用它。它可以在 64 位 Windows 上使用，但调试器仅适用于 32 位程序。
 
你可以在代码中设置断点、检查变量值、查看 Lua 和本地（C++）调用栈。当执行错误的 Lua 脚本时，Decoda 还会中断程序的执行，提供详细的错误信息并直接指向错误代码。你甚至可以将一个 C++ 调试器附加到一个正在被 Decoda 调试的进程上，这样就可以同时捕获 C++ 和 Lua 错误。

Decoda 是开源软件，源代码在 GitHub 上：https://github.com/unknownworlds/decoda  您可以从创建者的网站 https://unknownworlds.com/decoda/ 下载编译后的二进制文件。

## 项目管理
要开始使用 Decoda，您需要创建一个项目，或加载一个现有项目。Decoda 项目的扩展名是 .deproj，它只是一个要打开的 Lua 文件列表。您可以通过 "项目"->"新建项目 "菜单创建项目。首先保存项目，以便 Decoda 知道文件的相对路径。然后通过菜单 Project -> Add Add New File / Add Existing File 添加现有 Lua 文件或创建新文件。

接下来需要设置 Decoda 在调试文件时运行的可执行文件。选择菜单 Project -> Settings。将打开一个新对话框。

在调试部分，填写 Cuberite.exe 的完整路径，或点击三点按钮浏览文件。请注意，工作目录会自动填入可执行文件所在的文件夹（直到最后一个反斜杠）。如果由于某种原因没有更新，请复制并粘贴命令编辑框中的文件夹名称。完成后，就可以关闭对话框了。

## 调试
现在您可以调试代码了。不过在此之前，别忘了保存项目文件。如果尚未启用插件，请在 settings.ini 文件中启用插件。如果想让程序在某一行中断，最好在启动程序前设置断点。将光标放在该行上，然后点击 F9（或使用菜单 Debug -> Toggle Breakpoint）在该行上切换断点。最后，点击 F5，或选择菜单 Debug -> Start，在调试器下启动 Cuberite。Cuberite 窗口会弹出并加载您的插件。如果 Decoda 显示的是 "项目设置"（Project Settings）对话框，则说明您尚未设置可执行文件的运行，请参阅 "项目管理 "部分的说明。

此时，您会看到 Decoda 开始向项目中添加新项目。所有插件的文件都是临时添加的。别担心，它们只是临时的，一旦调试会话结束，它们就会被移除。你可以通过图标来区分临时文件和常规文件，图标是淡出的。Decoda 会处理 Cuberite 加载的所有文件，因此你也可以调试任何这些淡出的文件。

如果代码中出现错误，Decoda 窗口会闪烁并弹出一个对话框，描述错误并带您到出现错误的行。请注意，执行插件的线程会暂停执行，因此在您从菜单中选择调试 -> 继续（F5）之前，Cuberite 不会完全运行。您可以修复错误，并在 Cuberite 控制台中发出 "reload"（重新加载）命令，重新加载插件代码（Cuberite 不会自动检测插件代码的更改）。

如果执行过程中遇到断点，Decoda 窗口将闪烁并在该行旁边显示黄色箭头。您可以使用 F10 和 F11 步进代码，就像在 MSVS 中一样。你还可以使用观察窗口来检查变量值，或者直接将鼠标悬停在变量上，在工具提示中显示变量值。
## 局限性
到目前为止，一切似乎都很美好。遗憾的是，事情并不总是那么简单。Decoda 的功能有几个限制：

当程序遇到逻辑错误（使用 nil 值、调用不存在的函数等）时，Decoda 就会崩溃，但通常 Watch 窗口和工具提示会显示无意义的值。如果你经常遇到这样的问题，请在代码中加入控制台日志函数 (LOG)，以便在故障发生前打印出你需要的任何信息。

有时断点不起作用。如果有多个插件的文件名相同，情况尤其如此。在 Cuberite 中更改代码并重新加载插件后，断点将永远无法工作；您需要停止服务器并重新启动才能重新启用断点。

最奇怪的是，有时 Decoda 会报错，但不是打开当前版本的文件，而是打开另一个窗口，显示文件的旧内容。请注意这一点，因为如果你将该文件保存在较新的文件上，可能会覆盖你的新代码。幸运的是，在保存此类文件之前，Decoda 总是会询问你的文件名。

Decoda 将项目存储在两个文件中。.deproj 文件包含文件列表，应放入版本控制系统。.deuser 文件包含设置（调试程序等），是针对每个用户的。该文件不应放入版本控制系统，因为每个用户可能有不同的调试路径。

不幸的是，对于 Windows 用户来说，Decoda 项目文件使用的是 Unix-lineends（仅限 CR）。这使得在版本控制系统中检查文件时出现问题，因为这些系统通常希望使用 windows (CRLF) 行尾；我个人每次使用 TED 记事本编辑项目文件时都会转换行尾。
